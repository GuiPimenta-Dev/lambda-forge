
<!DOCTYPE html>
<html lang="en">
	<head>
		<script src="https://cdn.tailwindcss.com"></script>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
    	<title>Chat App</title>
    	<meta name="description" content="Generated by create next app" />
    	<link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16" />
    	<script
    		src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"
    		crossorigin=""
    		nomodule=""
    	></script>
    </head>
    <body class="__className_aaf875">
    	<main class="bg-gray-100 mb-12 pb-6">
    		<div class="flex gap-4 justify-around px-2 pt-6">
    			<!-- CHAT -->
    			<div class="bg-white px-3 py-5 w-[48%] flex flex-col shadow-xl">
    				<div class="flex gap-2 border-b pb-3 items-center justify-between">
    					<div class="flex gap-3 items-center">
    						<div class="bg-sky-700 w-10 h-10 rounded-full"></div>
    						<div class="">
    							<p class="font-bold" id="ïd1">Chat 1</p>
    						</div>
    					</div>
    				</div>
    				<ul
    					id="messages1"
    					class="w-full h-[450px] max-h-[450px] overflow-y-auto px-1"
    				>
    				</ul>
    				<div
    					class="items-center w-full flex gap-2 mt-6 text-[15px] justify-center"
    				>
    					<input
    						id="messageInput1"
    						placeholder="Type your text..."
    						class="p-2 h-7 flex-1 border border-gray-300 rounded-xl bg-gray-100"
    					/><button
    						id="sendMessage1"
    						sendMessage()
    						class="rounded-md h-7 w-7 justify-center bg-blue-500 text-white font-medium items-center flex gap-2"
    					>
    						<svg
    							xmlns="http://www.w3.org/2000/svg"
    							viewBox="0 0 24 24"
    							fill="currentColor"
    							aria-hidden="true"
    							data-slot="icon"
    							class="w-[18px] h-[18px]"
    						>
    							<path
    								d="M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"
    							></path>
    						</svg>
    					</button>
    				</div>
    			</div>
    			<div class="bg-white px-3 py-5 w-[48%] flex flex-col shadow-xl">
    				<div class="flex gap-2 border-b pb-3 items-center justify-between">
    					<div class="flex gap-3 items-center">
    						<div class="bg-orange-400 w-10 h-10 rounded-full"></div>
    						<div class="">
    							<p class="font-bold" id="id2">Chat 2</p>
    						</div>
    					</div>
    				</div>
    				<!-- MESSAGE 2 SENDED -->
    				<ul id="messages2" class="w-full h-[450px] max-h-[450px] overflow-y-auto px-1" >
    				</ul>
    				<div
    					class="items-center w-full flex gap-2 mt-6 text-[15px] justify-center"
    				>
    					<input
    						id="messageInput2"
    						placeholder="Type your text..."
    						class="p-2 h-7 flex-1 border border-gray-300 rounded-xl bg-gray-100"
    					/><button
    						id="sendMessage2"
    						sendMessage()
    						class="rounded-md h-7 w-7 justify-center bg-blue-500 text-white font-medium items-center flex gap-2"
    					>
    						<svg
    							xmlns="http://www.w3.org/2000/svg"
    							viewBox="0 0 24 24"
    							fill="currentColor"
    							aria-hidden="true"
    							data-slot="icon"
    							class="w-[18px] h-[18px]"
    						>
    							<path
    								d="M3.478 2.404a.75.75 0 0 0-.926.941l2.432 7.905H13.5a.75.75 0 0 1 0 1.5H4.984l-2.432 7.905a.75.75 0 0 0 .926.94 60.519 60.519 0 0 0 18.445-8.986.75.75 0 0 0 0-1.218A60.517 60.517 0 0 0 3.478 2.404Z"
    							></path>
    						</svg>
    					</button>
    				</div>
    		</div>
    	</main>
    	<script>const BASE_URL = 'wss://2clnav84i7.execute-api.us-east-2.amazonaws.com/dev/';

    		// SOCKET 1
    		const sendButton1 = document.getElementById('sendMessage1');
    		sendButton1.addEventListener('click', sendMessage1);
    		let id1;

    		const socket1 = new WebSocket(BASE_URL);

    		socket1.onopen = function (event) {
    			console.log('Conexão estabelecida.');
    		};

    		socket1.onmessage = function (event) {
    			console.log('Mensagem recebida:', event.data);
    			const data = JSON.parse(event.data);
    			if (data.connection_id) {
    				id1 = data.connection_id;
    				return;
    			}

    			const messagesDiv = document.querySelector('#messages1');

    			messageReader(id1, data.sender_id, messagesDiv, data.message);
    		};

    		socket1.onerror = function (error) {
    			console.error('Erro na conexão WebSocket:', error);
    		};

    		socket1.onclose = function (event) {
    			if (event.wasClean) {
    				console.log('Conexão fechada corretamente.');
    			} else {
    				console.error('Conexão fechada com erro.');
    			}
    			console.log('Código do fechamento:', event.code, 'Motivo:', event.reason);
    		};

    		function sendMessage1() {
    			const messageInput = document.getElementById('messageInput1');
    			const messageText = messageInput.value;
    			const message = {
    				action: 'sendMessage',
    				message: messageText,
    				recipient_id: id2,
    			};

    			const stringMessage = JSON.stringify(message);
    			console.log(stringMessage);
    			if (messageText.trim() !== '') {
    				console.log(stringMessage);
    				socket1.send(stringMessage);
    				messageInput.value = '';
    			} else {
    				alert('Write a message');
    			}
    		}

    		const messageReader = (myId, senderId, selector, text) => {
    			console.log(myId, senderId);
    			const newListItem = document.createElement('li');
    			newListItem.classList.add('mb-1', 'flex', 'gap-2', 'false');
    			if (myId == senderId) {
    				newListItem.classList.add('flex-row-reverse');
    				newListItem.innerHTML = `
    				<div class="bg-blue-400 hidden w-9 h-9 rounded-full"></div>
    									<div
    										class="self-end max-w-[93%] mt-1 p-3 rounded-b-2xl rounded-tl-2xl bg-blue-300/30"
    									>
    										<p class="text-[15px]">
    											${text}
    										</p>

    									</div>`;
    			} else {
    				newListItem.innerHTML = `
    				<div class="bg-orange-400 hidden w-9 h-9 rounded-full"></div>
    				<div
    				class="self-end max-w-[93%] mt-1 p-3 rounded-b-2xl rounded-tr-2xl bg-orange-300/30"
    				>
    				<p class="text-[15px]">
    				${text}
    				</p>
    				</div>`;
    			}
    			selector.appendChild(newListItem);
    		};

    		// SOCKET 2
    		const sendButton2 = document.getElementById('sendMessage2');
    		sendButton2.addEventListener('click', sendMessage2);


    		const socket2 = new WebSocket(BASE_URL);
    		let id2;

    		socket2.onopen = function (event) {
    			console.log('Conexão estabelecida.');
    		};

    		socket2.onmessage = function (event) {
    			console.log('Mensagem recebida:', event.data);
    			const data = JSON.parse(event.data);
    			console.log(data);
    			if (data.connection_id) {
    				id2 = data.connection_id;
    				return;
    			}

    			const messagesDiv = document.querySelector('#messages2');

    			messageReader(id2, data.sender_id, messagesDiv, data.message);
    		};

    		socket2.onerror = function (error) {
    			console.error('Erro na conexão WebSocket:', error);
    		};

    		socket2.onclose = function (event) {
    			if (event.wasClean) {
    				console.log('Conexão fechada corretamente.');
    			} else {
    				console.error('Conexão fechada com erro.');
    			}
    			console.log('Código do fechamento:', event.code, 'Motivo:', event.reason);
    		};

    		function sendMessage2() {
    			const messageInput = document.getElementById('messageInput2');
    			const messageText = messageInput.value;
    			const message = {
    				action: 'sendMessage',
    				message: messageText,
    				recipient_id: id1,
    			};
    			const stringMessage = JSON.stringify(message);
    			if (messageText.trim() !== '') {
    				console.log(stringMessage);
    				socket2.send(stringMessage);
    				messageInput.value = '';
    			} else {
    				alert('Write a message');
    			}
    		}
    		</script>
    	<!-- <script src="script.js">

    	</script> -->

    </body>

</html>